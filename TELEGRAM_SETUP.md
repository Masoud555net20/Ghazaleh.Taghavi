# راه‌اندازی ربات تلگرام برای نوتیفیکیشن رزروهای مشاوره

## 📋 مراحل راه‌اندازی ربات تلگرام

### مرحله ۱: ساخت ربات جدید 🤖

1. **وارد تلگرام شوید**
   - تلگرام را باز کنید و @BotFather را جستجو کنید
   - روی @BotFather ضربه بزنید تا شروع به چت کنید

2. **دستور شروع ربات**
   ```
   /start
   ```

3. **ایجاد ربات جدید**
   ```
   /newbot
   ```

4. **نام ربات را انتخاب کنید**
   - نامی برای ربات انتخاب کنید (مثلاً: `Legal Consultation Bot`)
   - پیام سیستم: "Alright, a new bot. How are we going to call it? Please choose a name for your bot."

5. **یوزرنیم ربات را انتخاب کنید**
   - یوزرنیم باید با `_bot` ختم شود (مثلاً: `legal_consultation_bot`)
   - پیام سیستم: "Good. Now let's choose a username for your bot. It must end in `bot`. Like this, for example: TetrisBot or tetris_bot."

6. **دریافت توکن ربات**
   - پس از انتخاب یوزرنیم، توکن ربات را دریافت می‌کنید
   - توکن چیزی شبیه به این است: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`
   - **این توکن را در جایی امن ذخیره کنید!**

### مرحله ۲: تنظیمات اولیه ربات ⚙️

1. **تنظیم توضیحات ربات**
   ```
   /setdescription
   ```
   متن توضیحات پیشنهادی:
   ```
   🤖 ربات نوتیفیکیشن رزروهای مشاوره حقوقی
   ارسال خودکار پیام‌های رزرو به گروه مدیریت
   ```

2. **تنظیم متن درباره ربات**
   ```
   /setabouttext
   ```
   متن درباره پیشنهادی:
   ```
   ربات هوشمند برای مدیریت نوتیفیکیشن‌های رزرو مشاوره
   ```

3. **تنظیم دستورات ربات**
   ```
   /setcommands
   ```
   دستورات پیشنهادی:
   ```
   start - شروع کار با ربات
   help - راهنما
   status - وضعیت ربات
   ```

### مرحله ۳: ایجاد گروه تلگرام 👥

1. **ایجاد گروه جدید**
   - در تلگرام یک گروه جدید بسازید
   - نام گروه را انتخاب کنید (مثلاً: "نوتیفیکیشن رزروهای مشاوره")

2. **اضافه کردن ربات به گروه**
   - ربات را به گروه اضافه کنید
   - دستور: گروه را باز کنید → Add Members → ربات را جستجو کنید

3. **ادمین کردن ربات**
   - روی ربات در گروه راست کلیک کنید
   - گزینه "Promote to Admin" را انتخاب کنید
   - تمام دسترسی‌ها را فعال کنید

### مرحله ۴: دریافت Chat ID گروه 📍

برای دریافت Chat ID گروه، چند روش وجود دارد:

#### روش ۱: استفاده از ربات (پیشنهادی)
1. ربات @userinfobot را به گروه اضافه کنید
2. در گروه دستور `/start` را ارسال کنید
3. Chat ID گروه نمایش داده می‌شود

#### روش ۲: استفاده از API
1. توکن ربات خود را داشته باشید
2. از طریق API تست کنید:
   ```bash
   curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates"
   ```

#### روش ۳: استفاده از وبسایت‌های آنلاین
- به سایت‌هایی مثل https://api.telegram.org/bot<TOKEN>/getUpdates مراجعه کنید
- یا از سایت‌های مخصوص دریافت Chat ID استفاده کنید

### مرحله ۵: تنظیم متغیرهای محیطی 🔧

پس از دریافت توکن و Chat ID، فایل `.env` را به‌روزرسانی کنید:

```env
# تنظیمات تلگرام برای ارسال نوتیفیکیشن
VITE_TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
VITE_TELEGRAM_CHAT_ID=-1001234567890

# Worker جدید تلگرام
VITE_TELEGRAM_WORKER_URL=https://telegram-notifier.masoud555net.workers.dev
```

**نکته مهم:** Chat ID گروه‌ها معمولاً با `-100` شروع می‌شود.

### مرحله ۶: تست اتصال 🧪

1. **تست Worker تلگرام**
   ```bash
   curl https://telegram-notifier.masoud555net.workers.dev/api/telegram/test
   ```

2. **تست ارسال پیام نمونه**
   ```bash
   curl -X POST https://telegram-notifier.masoud555net.workers.dev/api/telegram/send-consultation \
     -H "Content-Type: application/json" \
     -d '{
       "name": "تست کاربر",
       "phone": "09123456789",
       "consultation_type": "phone",
       "preferred_date": "2025-01-15",
       "preferred_time": "10:00"
     }'
   ```

## 🎨 فرمت پیام‌های تلگرام

پیام‌های ارسالی به این صورت خواهند بود:

```
📋 درخواست رزرو مشاوره جدید

👤 نام و نام خانوادگی:
   محمد احمدی

📱 شماره تلفن:
   09123456789

🏛️ استان:
   تهران

🏙️ شهر:
   تهران

📋 موضوع مشاوره:
   👨‍👩‍👧‍👦 خانوادگی

📝 شرح مشکل:
   نیاز به مشاوره در مورد طلاق توافقی

📅 زمان رزرو:
   📅 تاریخ: ۱۴۰۳/۱۰/۲۵
   ⏰ زمان: ۱۰:۰۰
   🔧 نوع مشاوره: 📞 تلفنی

💬 توضیحات:
   لطفاً در مورد مدارک لازم راهنمایی کنید

━━━━━━━━━━━━━━━━━━━━━━
⏰ زمان ثبت: ۱۴۰۳/۱۰/۲۵، ۱۴:۳۰
🆔 شماره رزرو: ۱۲۳
━━━━━━━━━━━━━━━━━━━━━━

✅ درخواست با موفقیت ثبت شد!
```

## 🔒 نکات امنیتی مهم

1. **توکن ربات را محافظت کنید**
   - توکن را در اختیار دیگران قرار ندهید
   - توکن را در متغیرهای محیطی ذخیره کنید

2. **Chat ID را خصوصی نگه دارید**
   - Chat ID گروه را فقط برای افراد مجاز استفاده کنید

3. **Rate Limiting**
   - تلگرام محدودیت‌هایی برای تعداد پیام‌ها دارد
   - Worker به طور خودکار این محدودیت‌ها را مدیریت می‌کند

## 🚨 عیب‌یابی رایج

### خطا: "Unauthorized" یا "Bad Request: unauthorized"
- توکن ربات اشتباه است
- ربات در گروه ادمین نیست

### خطا: "Bad Request: chat not found"
- Chat ID اشتباه است
- گروه حذف شده یا ربات از گروه خارج شده

### خطا: "Bad Request: message is not modified"
- فرمت پیام HTML اشتباه است
- از کاراکترهای خاص بدون escape استفاده شده

## 📞 پشتیبانی

اگر در هر مرحله‌ای مشکل داشتید:
1. لاگ‌های Worker را در داشبورد Cloudflare چک کنید
2. تست اتصال را انجام دهید
3. از دستورات دیباگ استفاده کنید

---

**🎉 تبریک!** بعد از تکمیل این مراحل، سیستم شما آماده ارسال نوتیفیکیشن‌های زیبا به تلگرام خواهد بود!
